(()=>{var t={338:(t,e,i)=>{const n=i(538),o=i(655),a=i(734),s={openApp:async function(){o.log("Mở app...");const t="com.cell47.College_Proxy";await o.inputKey("3"),await o.stopApp(t),await o.sleep(1),await o.clearData(t),await o.sleep(1),await o.openApp(t),await o.sleep(5),await o.findByXpath("id:android:id/alertTitle",5)||(o.logError("Không khởi động được app proxy"),a.isRunning=!1)},confirmDialog:async function(){const t=await o.findByXpath("id:android:id/alertTitle",2);if(t)switch(await t.getText()){case"Location Permission Needed!":case"Permission Needed!":await o.tabByXPath("//android.widget.Button[contains(@text, 'CANCEL')]",2),n.currentFunctionIndex--;break;default:await o.tabByXPath("//android.widget.Button[contains(@text, 'OK')]",2)}else await o.tabByXPath("id:android:id/button1",2)},settingPermissions:async function(){if(await o.findByXpath("id:android:id/alertTitle",2))return void n.currentFunctionIndex--;let t;o.log("Thiết lập loại trừ termux ..."),await o.sleep(1),await o.tabByXPath("//android.widget.TextView[contains(@text, 'More Options')]",2),await o.tabByXPath("id:com.cell47.College_Proxy:id/menu_item_setting",2);let e=0;for(;!t&&e<50;)e++,t=await o.findByXpath("//android.widget.TextView[contains(@text, 'com.termux')]",1),await o.swipeUp();t?t.click():(o.log("Dừng hành động..."),a.isRunning=!1),await o.tabByXPath("//android.widget.Button[contains(@text, 'SAVE SETTINGS')]",1)},setProxy:async function(){o.log("Thêm proxy để chạy ...");const t=await o.findByXpath("id:com.cell47.College_Proxy:id/editText_address",2);t&&(await t.clearValue(),await t.click(),await o.inputText(a.proxy.host));const e=await o.findByXpath("id:com.cell47.College_Proxy:id/editText_port",2);e&&(await e.clearValue(),await e.click(),await o.inputText(a.proxy.port));const i=await o.findByXpath("id:com.cell47.College_Proxy:id/editText_username",2),n=await o.findByXpath("id:com.cell47.College_Proxy:id/editText_password",2);a.proxy.username&&a.proxy.pass&&i&&n&&(await i.clearValue(),await i.click(),await o.inputText(a.proxy.username),await n.clearValue(),await n.click(),await o.inputText(a.proxy.pass)),await o.tabByXPath("id:com.cell47.College_Proxy:id/proxy_start_button",1),await o.tabByXPath("id:android:id/button1",5);const s=await o.findByXpath("id:android:id/alertTitle",5);if("Configuration Ready"==await s.getText()){await o.tabByXPath("id:android:id/button1"),await o.tabByXPath("id:com.sec.android.app.sbrowser:id/customtab_close");const t=await o.findByXpath("id:com.cell47.College_Proxy:id/id_ok",1);t&&t.click(),await o.inputKey("3"),o.Log("Kết nối proxy thành công")}}};t.exports=async function(){if(!a.proxy)return o.logError("Thiết bị chưa được cấu hình proxy"),!1;await n.Run(s)}},314:(t,e,i)=>{const n=i(538),o=(i(655),i(734),{});t.exports=async function(){await n.Run(o)}},342:(t,e,i)=>{const n=i(538),o=i(655),a=i(734),s="com.google.android.youtube",r={installApp:async function(){o.log("Kiem tra cai dat youtube"),await o.installApp(s,"https://auto.dndvina.com/apk/YouTube_18.43.41.apk")},openApp:async function(){o.log("Mở youtube"),await o.inputKey("3"),await o.stopApp(s),await o.sleep(1),await o.clearData(s),await o.sleep(1),await o.openApp(s),await o.sleep(5),await o.findByXpath("id:com.google.android.youtube:id/bottom_bar_container",10)||(o.logError("Không mở được ứng dụng.."),a.isRunning=!1)},findPlaylist:async function(){o.log("Tìm kiếm danh sách phát theo từ khóa"),await o.tabByXPath('//android.widget.ImageView[@content-desc="Search"]'),await o.inputText(n.params.listKey),await o.inputKey("66");let t,e=0;for(;!t&&e<10&&(e++,a.isRunning);)t=await o.findByXpath(`//android.view.ViewGroup[contains(@content-desc, '${n.params.keyVal}')]`,1),t||await o.swipeUp();t&&(await o.sleep(1),t.click()),await o.tabByXPath("id:com.google.android.youtube:id/shuffle_button_label")},viewVideo:async function(){}};t.exports=async function(t){n.params=t,await n.Run(r)}},636:(t,e,i)=>{const n=i(538),o=i(655),a=(i(734),{proxyAPK:async function(){await o.installApp("com.cell47.College_Proxy","https://auto.dndvina.com/apk/collegeproxy.apk")},adbApk:async function(){await o.isAdbKeyboardInstalled()||(await o.installApp("com.android.adbkeyboard","https://auto.dndvina.com/apk/ADBKeyboard.apk"),await o.runAdbShellCommand("ime enable com.android.adbkeyboard/.AdbIME"),await o.runAdbShellCommand("ime set com.android.adbkeyboard/.AdbIME"))},youtube:async function(){o.log("Kiem tra cai dat youtube"),await o.installApp("com.google.android.youtube","https://auto.dndvina.com/apk/YouTube_18.43.41.apk")}});t.exports=async function(){await n.Run(a)}},52:(t,e,i)=>{const n=i(538),o=i(655),a=(i(734),"com.twitter.android"),s={openApp:async function(){o.log("Mở X"),await o.inputKey("3"),await o.installApp(a,"https://auto.dndvina.com/apk/twitter-x10.14.0.apk"),await o.stopApp(a),await o.sleep(1),await o.clearData(a),await o.sleep(1),await o.openApp(a),await o.sleep(5)}};t.exports=async function(){await n.Run(s)}},772:(t,e,i)=>{const n=i(538),o=i(655),a=i(734),s="com.google.android.youtube",r={openApp:async function(){o.log("Mở youtube"),await o.inputKey("3"),await o.stopApp(s),await o.sleep(1),await o.clearData(s),await o.sleep(1),await o.openApp(s),await o.sleep(5),await o.findByXpath("id:com.google.android.youtube:id/youtube_logo",10)||(o.logError("Không mở được ứng dụng.."),a.isRunning=!1)}};t.exports=async function(t){n.params=t,await n.Run(r)}},67:(t,e,i)=>{const n=i(538),o=i(655),a=i(734),s={findVideo:async function(){if(o.log("Tìm kiếm video theo từ khóa"),!n.params.listKey||!n.params.listKey.includes("|"))return a.isRunning=!1,void o.logError("Param không hợp lệ.");const t=n.params.listKey,e=t.split("|")[0],i=t.split("|")[1];await o.tabByXPath('//android.widget.ImageView[@content-desc="Search"]'),await o.isKeyboardShown()||await o.tabByXPath("id:com.google.android.youtube:id/search_edit_text"),await o.sleep(1),await o.inputText(e),await o.inputKey("66");let s,r=0;for(;!s&&r<50&&(r++,a.isRunning);)s=await o.findByXpath(`//android.view.ViewGroup[contains(@content-desc, '${i}')]`,1),s||await o.swipeUp();s?(await o.sleep(1),n.cVideoName=await s.getAttribute("content-desc"),await s.click()):(o.logError("không tìm được video"),a.isRunning=!1)},viewVideo:async function(){if(!await o.findByXpath("id:com.google.android.youtube:id/watch_while_time_bar_view",2))return this.currentFunctionIndex--,void o.logError(`không xem được video ${n.cVideoName}`);o.log(`Bắt đầu xem video ${n.cVideoName}`);const t=o.getRandomInt(5e4,15e4);o.log(`Tổng thời gian sẽ xem ${t/1e3} giây`);let e=0;for(;e<t;){e+=1e4;const t=await o.findByXpath("id:com.google.android.youtube:id/skip_ad_button",1);t?(o.log("Bấm bỏ qua quảng cáo..."),t.click()):o.log(`Đang xem video ${n.cVideoName}`),await o.sleep(5)}o.log("Đã xem xong video...")}};t.exports=async function(t){n.params=t,await n.Run(s)}},444:(t,e,i)=>{var n={"./AddProxy":338,"./AddProxy.js":338,"./Temp":314,"./Temp.js":314,"./Youtube-Playlist":342,"./Youtube-Playlist.js":342,"./install":636,"./install.js":636,"./reg-x":52,"./reg-x.js":52,"./youtube-open":772,"./youtube-open.js":772,"./youtube-search":67,"./youtube-search.js":67};function o(t){var e=a(t);return i(e)}function a(t){if(!i.o(n,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return n[t]}o.keys=function(){return Object.keys(n)},o.resolve=a,t.exports=o,o.id=444},973:(t,e,i)=>{const n=i(17),o=i(142),a=process.cwd();o.config({path:".env.product"}),t.exports={version:2.6,projectRoot:a,isDevMode:!1,binPath:"/data/data/com.termux/files/usr/bin/",apiURL:process.env.API_URL,wsURL:process.env.WS_URL,apiURLv2:process.env.API_URL_V2,configPath:n.join(a,"./contents/userconfig.json"),deviceConfig:n.join(a,"./contents/deviceconfig.json"),logFile:n.join(a,"./contents/log-mining.txt"),pathConfig:n.join(a,"./contents/config.json"),pathMining:n.join(a,"./contents/mining-script.sh"),pathUserKey:n.join(a,"../tbhkey"),pathDeviceKey:n.join(a,"../devicekey"),ADB_PORT:process.env.ADB_PORT,APPIUM_PORT:4739,AppiumStatus:{NOT_RUNNING:0,STARTING:1,RUNNING:2}}},538:(t,e,i)=>{const n=i(203),o=i(734);t.exports=new class{constructor(){this.isRunning=!0,this.currentFunctionIndex=0}async Run(t){if("object"!=typeof t)return void n.error("fnAction should be an object with functions.");const e=Object.values(t);for(this.currentFunctionIndex=0;this.isRunning&&o.isRunning&&this.currentFunctionIndex<e.length;){const t=e[this.currentFunctionIndex];await t.call(this),this.isRunning||n.log(`Function ${this.currentFunctionIndex+1} encountered an error.`),this.currentFunctionIndex++}}}},245:(t,e,i)=>{const n=i(167),o=(i(734),i(973));t.exports={getTaskDetail:async function(t){const e=`${o.apiURLv2}/script/getByScriptId/${t}`;return await this.get(e)},get:async function(t){const e=(await n.get(t)).data;if(e.data)return e.data}}},919:(t,e,i)=>{const{exec:n,execSync:o}=i(81),a=i(734),s=i(203),r=i(973);t.exports={appiumProcess:null,startAppServer:function(){if(a.appiumStatus===r.AppiumStatus.NOT_RUNNING){let t=`export JAVA_HOME=/data/data/com.termux/files/usr/opt/openjdk && export ANDROID_HOME=/data/data/com.termux/files/usr/share/android-sdk && appium --port ${r.APPIUM_PORT}`;"pNIXsc4kU"==a.deviceId&&(t=`appium --port ${r.APPIUM_PORT}`),this.appiumProcess=n(t),a.appiumStatus=r.AppiumStatus.STARTING,s.info("Khởi động Server App..."),this.appiumProcess.stdout.on("data",(t=>{t.includes("Appium REST http interface listener started on http://0.0.0.0:")&&(s.info("Server App đã hoạt động."),a.appiumStatus=r.AppiumStatus.RUNNING,this.appiumProcess.stdout.removeAllListeners("data"))})),this.appiumProcess.stderr.setEncoding("utf8"),this.appiumProcess.stderr.on("data",(t=>{console.log(`[Serrver App]:${t}`)})),this.appiumProcess.on("close",(t=>{s.error(`Server App dừng ${t}.`),a.appiumStatus=r.AppiumStatus.NOT_RUNNING,this.appiumProcess=null}))}else s.info("Server App đang chạy")},stopAppServer:async function(){a.appiumStatus===r.AppiumStatus.RUNNING&&(this.appiumProcess.kill(),this.appiumProcess=null,s.info("Đã dừng Server App."),a.appiumStatus=r.AppiumStatus.NOT_RUNNING),this.appiumProcess=null}}},655:(t,e,i)=>{const{exec:n,execSync:o}=i(81),a=i(171),s=i(734),r=i(203),c=i(167),d=i(17),u=i(147),l=i(973);t.exports={driver:null,connectAP:async function(){try{if(!this.driver){const t={hostname:"127.0.0.1",port:l.APPIUM_PORT,logLevel:"error",capabilities:{platformName:"Android","appium:udid":s.adbId,"appium:automationName":"UiAutomator2","appium:platformVersion":`${s.androidVersion||9}`,"appium:adbPort":l.ADB_PORT}};this.driver=await a.remote(t),r.info("Đã kết nối đến Server App.")}return!0}catch(t){return r.error(`Loi khoi tao driver${t}`),!1}},disconnectAP:async function(){this.driver&&this.driver.is&&(await this.driver.deleteSession(),this.driver=null)},customAction:async function(t,e){try{const n=`./customActions/${t}.js`,o=i(273)(n);await o(this,e)}catch(e){r.error(`Không tìm thấy hành động: ${t}`),this.running=!1}},isKeyboardShown:async function(){return await this.driver.isKeyboardShown()},fixRotation:async function(){await this.runAdbShellCommand("settings put system accelerometer_rotation 0")},tabByXPath:async function(t){const e=await this.driver.$(t);await e.isExisting()?await e.click():r.error(`Không tìm thấy phần tử với xpath: ${t}`)},findByXpath:async function(t,e=1){let i,n=!1,o=1;for(;o<=e&&!n;)i=await this.driver.$(t,1e3),n=await i.isExisting(),o++,await this.sleep(1);return n?i:null},moveUp:async function(){await this.driver.touchAction([{action:"press",x:473,y:1352},{action:"moveTo",x:511,y:735},"release"])},tap:async function(t,e){await this.driver.touchAction({actions:"tap",x:t,y:e})},swipeUp:async function(){await this.runAdbShellCommand("input swipe 200 985 200 35")},swipeDown:async function(){await this.driver.touchAction([{action:"press",x:300,y:236},{action:"moveTo",x:300,y:936},"release"])},swipeLeft:async function(){await this.driver.touchAction([{action:"press",x:879,y:450},{action:"moveTo",x:179,y:450},"release"])},swipeRight:async function(){await this.driver.touchAction([{action:"press",x:179,y:450},{action:"moveTo",x:879,y:450},"release"])},inputText:async function(t){if(await this.isAdbKeyboardInstalled())for(let e=0;e<t.length;e++){const i=Buffer.from(t.charAt(e)).toString("base64");await this.runAdbShellCommand(`am broadcast -a ADB_INPUT_B64 --es msg '${i}'`);const n=Math.floor(-299*Math.random()+50);await new Promise((t=>setTimeout(t,n)))}else await this.runAdbShellCommand(`input text ${t}`)},isAdbKeyboardInstalled:async function(){try{const t=await this.runAdbShellCommand("ime list -a");return!!t&&t.includes("com.android.adbkeyboard/.AdbIME")}catch(t){return!1}},inputKey:async function(t){await this.runAdbShellCommand(`input keyevent  "${t}"`)},sleep:async function(t){await new Promise((e=>setTimeout(e,1e3*t)))},clearData:async function(t){await this.runAdbShellCommand(`pm clear ${t}`)},stopApp:async function(t){await this.runAdbShellCommand(`am force-stop ${t}`)},openApp:async function(t,e){if(!await this.isAppInstalled(t))return r.error(`Chưa cài: ${t}`),!1;await this.runAdbShellCommand(`monkey -p ${t}${e||""} -c android.intent.category.LAUNCHER 1`),await this.fixRotation()},isAppInstalled:async function(t){try{return(await this.runAdbShellCommand("pm list packages")).indexOf(t)>-1}catch(t){return r.error(`Lỗi xảy ra: ${t}`),!1}},installApp:async function(t,e){try{if(!await this.isAppInstalled(t)){const t=await this.downloadFile(e);await this.runAdbCommand(`install ${t}`),console.log(`Đã cài đặt ứng dụng từ ${e}`)}}catch(t){console.error(`Lỗi xảy ra khi tải và cài đặt ứng dụng: ${t}`),s.isRunning=!1}},downloadFile:async function(t){try{const e=await c.get(t,{responseType:"stream"}),i=d.basename(t),n=d.join("/","../../contents",i);await u.mkdir(d.dirname(n),{recursive:!0},(t=>{t&&console.error(`Lỗi khi tạo thư mục: ${t}`)}));const o=u.createWriteStream(n);return e.data.pipe(o),await new Promise(((t,e)=>{o.on("finish",t),o.on("error",e)})),console.log(`Tải tệp từ ${t} thành công và đã lưu vào ${n}`),n}catch(e){return console.error(`Lỗi xảy ra khi tải tệp từ ${t}: ${e}`),null}},pullFile:async function(t,e){const i=`pull ${t} ${e}`;await this.runAdbCommand(i)},runAdbShellCommand:async function(t){const e=`adb -P ${l.ADB_PORT} -s ${s.adbId} shell ${t}`;return new Promise(((t,i)=>{n(e,((e,n,o)=>{e?(r.error(`Lỗi xảy ra: ${e}`),i(e)):t(n)}))}))},runAdbCommand:async function(t){const e=`adb -P ${l.ADB_PORT} -s ${s.adbId} ${t}`;return new Promise(((t,i)=>{n(e,((e,n,o)=>{e?(r.error(`Lỗi xảy ra: ${e}`),i(e)):t(n)}))}))},getRandomInt:function(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t)+t)},log:function(t){r.info(`${t}`),s.statusMessage=t},logError:function(t){r.error(`[Lỗi]-${t}`),s.statusMessage=t}}},604:(t,e,i)=>{const{promisify:n}=i(837),o=(i(17),n(i(718).execFile),i(81).exec),a=i(167),s=i(973),r=i(370);var c=i(77);const d=i(946),u=i(147),l=n(u.exists),p=n(u.readFile),h=n(u.writeFile);t.exports={async getProp(t){try{const{stdout:e,stderr:i}=await n(o)(`getprop ${t}`);return i?null:e.trim()}catch(t){return null}},killProcess(t){o(`chmod u+x ${filePath}`,((e,i,n)=>{e?console.error(`Kill process ${t} error: ${e}`):console.log(`Killed process ${t}`)}))},async getUserConfig(){let t;if(await l(s.configPath)){let e=u.readFileSync(s.configPath);t=JSON.parse(e);const i=(await a.get(`${s.apiURL}/user/get/${t.userName}`)).data;return i.data&&(t=i.data),t}{console.log(`Config đã thiết lập${s.configPath}`);const e=i(791);for(;!t;){let i=await e.question("Nhap thong tin User: ");const n=(await a.get(`${s.apiURL}/user/get/${i}`)).data;if(n.data)return t=n.data,await u.promises.writeFile(s.configPath,JSON.stringify(t)),t;console.log("User khong ton tai!")}}},async getDeviceConfig(){let t,e=await this.getProp("ro.serialno");return await l(s.deviceConfig)?(t=JSON.parse(await p(s.deviceConfig)),e&&e!=t.deviceId&&(t.deviceId=e)):t={deviceId:e||i(31).generate(),deviceName:await this.getProp("ro.product.model"),cpuUse:0},t.adbWifi=await this.checkADB(),t.root=await this.checkRootPermission(),t.localIp=this.getDeviceIP(),t.sshUser=await this.getUserSSH(),t.model=await this.getProp("ro.product.model"),t.cpuCores=this.getCpuCores(),await h(s.deviceConfig,JSON.stringify(t)),t},async removeConfig(t){try{t&&await l(s.configPath)&&(await u.unlinkSync(s.configPath),console.log("Da xoa thong tin user")),await l(s.deviceConfig)&&(await u.unlinkSync(s.deviceConfig),console.log("Da xoa thong tin thiet bi"))}catch(t){console.error(t)}},getDeviceIP(){try{return c.address()}catch(t){return t}},async getUserSSH(){const{stdout:t,error:e}=await n(o)("whoami");return e||t.trim()},async getCpuMhz(t){try{const{stdout:e,error:i}=await n(o)(`su -c "cat /sys/devices/system/cpu/cpu${t}/cpufreq/scaling_cur_freq"`);return i?0:parseInt(e.trim())}catch(t){return 0}},async getCpuUse(){try{const t=await r.currentLoad();return isNaN(t.currentLoad)?0:Math.round(t.currentLoad)}catch(t){return 0}},getCpuCores(){try{const t=d.cpu.count();return isNaN(t)?0:parseInt(t)}catch(t){return 0}},async getCpuTemperature(){try{return(await r.cpuTemperature()).main.toFixed(1)||0}catch(t){return 0}},async checkADB(){try{const t=n(o),e=await t(`adb -P ${s.ADB_PORT} devices`);return console.log(e),!!e.stdout.includes("emulator-5554")}catch(t){return console.log("Lỗi khi chạy lệnh adb:",t),!1}},async checkRootPermission(){try{const t=n(o),{stdout:e}=await t('su -c "id"');return!!e.toLowerCase().includes("uid=0")}catch(t){return!1}},async checkSudoLib(){try{const t=n(o),e=await t("sudo ls"),{stdout:i,stderr:a}=e;return!(!i.toLowerCase().includes("mnworker")&&!i.toLowerCase().includes("readme.md")&&(a&&a.length,1))}catch(t){return!1}},delay:async t=>new Promise((e=>setTimeout(e,t))),async checkServerConnection(){try{return!!((await a.get(`${s.apiURLv2}/device/get-config/${this.userId}/${this.deviceId}`)).data.status="success")}catch(t){return!1}}}},734:(t,e,i)=>{const{promisify:n}=i(837),o=i(147),a=n(o.exists),s=n(o.readFile),r=n(o.writeFile),c=i(973),d=i(604),u=i(167),{exec:l}=i(81);let p={userId:"",deviceId:"",root:!1,appiumStatus:c.AppiumStatus.NOT_RUNNING,getConfig:async function(){try{this.userId=await s(c.pathUserKey,"utf8"),this.userId=this.userId.trim();const t=await d.getProp("ro.serialno");t?this.deviceId=t:await a(c.pathDeviceKey)?this.deviceId=await s(c.pathDeviceKey,"utf8"):(this.deviceId=i(31).generate(),await r(c.pathDeviceKey,this.deviceId)),this.root=await d.checkRootPermission(),this.sudo=await d.checkSudoLib(),this.model=await d.getProp("ro.product.model"),this.AndroidVersion=await d.getProp("ro.build.version.release"),this.localIp=d.getDeviceIP();const e=this.versionConvert(this.AndroidVersion);return this.adbWifi=e>=9&&await d.checkADB(),"pNIXsc4kU"==this.deviceId?(this.adbId="10.0.0.145:5555",this.adbWifi=!0):this.adbId="emulator-5554",this.sshUser=await d.getUserSSH(),this.cpuCores=d.getCpuCores(),this.isMining=!1,this.statusMessage="",this.workerVersion=c.version,!0}catch(t){return console.error(`[Device] Không tìm thấy file user key '${c.pathUserKey}'.`),!1}},getConfigFromServer:async function(){try{console.log("[Device] Đọc thông tin thiết lập từ máy chủ...");const t=(await u.get(`${c.apiURLv2}/device/get-config/${this.userId}/${this.deviceId}`)).data;return t.data&&(Object.assign(this,t.data),this.deviceName=t.data.deviceName||this.model||"NoName",this.workerVersion=c.version,c.isDevMode&&(this.timeOutReport=5e3)),!0}catch(t){return console.error("[Device] Không đọc được thiết lập từ máy chủ."),!1}},getDeviceName:function(){return this.deviceName||this.deviceId},runCMD:function(t){return new Promise(((e,i)=>{l(t,((t,n,o)=>{t?i(t):e(n)}))}))},openApp:function(t){const e=`am start -n ${t}`;return this.runCMD(e)},versionConvert:function(t){try{const e=t.split(".")[0];return parseInt(e,10)||0}catch(t){return 0}}};t.exports=p},308:(t,e,i)=>{const n=i(734),o=(i(203),i(655)),a=i(919),s=i(245),r=i(604),c=i(973);t.exports={startJob:async function(){if(n.adbWifi=await r.checkADB()||"pNIXsc4kU"==n.deviceId,n.adbWifi){if(n.appiumStatus==c.AppiumStatus.STARTING&&(o.log("Chờ 30s khởi động server App..."),await o.sleep(30)),n.appiumStatus==c.AppiumStatus.NOT_RUNNING&&(a.startAppServer(),o.log("Chờ 30s khởi động lại server App..."),await o.sleep(30),n.appiumStatus!==c.AppiumStatus.STARTING))return o.logError("Server App không hoạt động"),void a.stopAppServer();if(n.isRunning=!0,await n.getConfigFromServer(),o.log("Kết nối máy chủ App..."),!await o.connectAP())return n.isRunning=!1,void o.logError("Không kết nối được máy chủ Appium...");if(n.jobAssign.jobScripts){for(const t of n.jobAssign.jobScripts){if(!n.isRunning)break;const e=await s.getTaskDetail(t.scriptId),a=i(444)(`./${e.scriptFile}`);o.log(`Chạy: ${e.scriptName}`);const r=JSON.parse(t.param);await a(r)}n.isRunning=!1,o.log("Hoàn tất Job...")}else n.isRunning=!1,o.logError("Không tìm thấy job")}else o.logError("Thiết bị không thể kết nối adb wifi.")},stopJob:async function(){n.isRunning&&(n.isRunning=!1,o.log("Tạm dừng Job..."))}}},203:(t,e,i)=>{const n=i(773),o=i(17),a=i(973),s={file:{level:"info",filename:o.resolve(a.projectRoot,"./logs/info.log"),handleExceptions:!0,json:!0,maxsize:1048576,maxFiles:5,colorize:!1},file:{level:"error",filename:o.resolve(a.projectRoot,"./logs/error.log"),handleExceptions:!0,json:!0,maxsize:1048576,maxFiles:5,colorize:!1},console:{level:"debug",handleExceptions:!0,json:!1,colorize:!0}},r=n.createLogger({levels:n.config.npm.levels,format:n.format.combine(n.format.timestamp(),n.format.prettyPrint(),n.format.printf((t=>`[${t.level}] ${t.timestamp} : ${t.message}`))),transports:[new n.transports.File(s.file),new n.transports.Console(s.console)],exitOnError:!1});t.exports=r},630:(t,e,i)=>{const n=i(973),o=i(604),a=i(734),{promisify:s}=i(837),r=s(i(147).writeFile),c=s(i(718).exec),{spawn:d,exec:u}=i(81),l=i(41),p=i(17),h=i(203);t.exports={isRunning:!1,setupFileMining:async function(){console.log(`[Mining] Thiết lập đào: ${a.jobAssign.jobName}...`);try{if(a.jobAssign.jobScripts){this.miningParams=a.jobAssign.jobScripts.param.replace("[DEVICE_ID]",a.deviceName),this.miningPath=a.jobAssign.jobScripts.filePath,this.fileMiningName=p.basename(this.miningPath),a.hash=0;const t=`#!/data/data/com.termux/files/usr/bin/sh\r\n${this.miningPath} ${this.miningParams}`;return await r(n.pathMining,t),await c(`chmod +x ${n.pathMining}`),await c(`chmod u+x ${this.miningPath}`),!0}}catch(t){console.log(t)}return console.log("[Mining] Không ghi được file đào tool đào"),!1},runMining:function(){a.hash=0,a.root&&a.sudo&&a.AndroidVersion.includes("9")?(this.miningProcess=d("sudo",["bash",n.pathMining]),console.log(`Bắt đầu đào: ${a.jobAssign.jobName} - SUDO`)):(this.miningProcess=d("bash",[n.pathMining]),console.log(`Bắt đầu đào: ${a.jobAssign.jobName}`)),this.isRunning=!0,a.isRunning=!0,this.miningProcess.stdout.setEncoding("utf8"),this.miningProcess.stdout.on("data",(t=>{console.log(`[Mining] ${t}`);try{let e=t;"xmrig"==this.fileMiningName&&(e=t.replace(/\u001B\[[0-9;]*m/g,""));const i={astrominer:/Hashrate\s([\d.]+)\s?[MK]?H\/s/,ccminer:/(\d+(?:\.\d+)?) kH\/s/,xmrig:/max\s(\d+\.\d+)\sH\/s/};let n=e.match(i[this.fileMiningName]);if(n){const t=n[1];t&&(a.hash=parseFloat(t.trim()))}a.statusMessage=`${a.jobAssign.jobName} - Hash: ${a.hash}`}catch(t){console.log(t),a.hash=0,a.statusMessage=`${a.jobAssign.jobName} - Hash: ${a.hash}`}})),this.miningProcess.stderr.setEncoding("utf8"),this.miningProcess.stderr.on("data",(t=>{console.error(`[Mining-error]: ${t}`)}))},stopMining:async function(){if(this.isRunning){if(this.miningProcess)try{l(this.miningProcess.pid,"SIGTERM",(t=>{t&&console.error("Error killing child process:",t)})),await o.delay(1e3);const t=`pkill -f "${this.fileMiningName}"`;a.root?await c(`su -c '${t}'`):await c(t),await o.delay(1e3)}catch(t){h.error(t.message)}finally{this.miningProcess=null}this.isRunning=!1,a.isRunning=!1,console.log(`[Mining] Tạm dừng đào:${a.jobAssign.jobName}`)}}}},367:(t,e,i)=>{const{promisify:n}=i(837),o=i(352),a=i(81),s=i(973),r=i(604),c=i(734),d=i(630),u=i(811);t.exports={isSendReport:!0,isConnected:!1,ws:null,connectWS:function(){try{if(!r.checkServerConnection())return void console.log("[Report-Error] Mất kết nối máy chủ !.");console.log(`[Report] Kết nối với máy chủ: ${c.userId} : ${c.deviceId} :${s.wsURL}`),this.ws=new o(s.wsURL),this.ws.addEventListener("open",(()=>{console.log("[Report] Đã kết nối đến máy chủ");const t={userId:c.userId,deviceId:c.deviceId,model:c.model,Status:1,localIp:c.localIp,sshUser:c.sshUser,cpuCores:c.cpuCores,root:c.root,workerVersion:c.workerVersion,androidVersion:c.AndroidVersion};console.log(t),this.isConnected=!0,this.isSendReport=!0,this.ws.send(JSON.stringify({command:"CLIENT_REGISTER",data:t}))})),this.ws.addEventListener("message",(t=>{const{command:e,data:i}=JSON.parse(t.data);switch(e){case"CLIENT_TASK":console.log(`Thực hiện lệnh ${i.command}`),this.executeCommand(i);break;case"CLIENT_UPDATE":!async function(t){for(d.isRunning&&await d.stopMining();!await c.getConfigFromServer();)console.log("[Device] Chờ 5s kết nối lại..."),await r.delay(5e3);c.isMining&&await d.setupFileMining()&&d.runMining()}();break;case"CHANGE_JOB":u.changeJob(i);break;case"CHANGE_STATUS_JOB":u.jobChangeStatus(i);break;default:c.userId,c.deviceId,this.ws.send(JSON.stringify({command:"CLIENT_TASK_RESULT",data:i})),console.log(`Thiết bị chưa được thiết lập nhận lệnh ${e}`)}"exec"===e&&this.executeCommand(i.command)})),this.ws.addEventListener("close",(()=>{this.isConnected=!1,this.isSendReport&&(this.ws=null,console.log("[Report] Mất kết nối máy chủ!"))}))}catch(t){this.isConnected=!1,console.log("[Report-Error] Lỗi kết nối rồi!",t),this.isSendReport&&(this.ws=null)}},sendStatusMessage:async function(){const t={deviceId:c.deviceId,userId:c.userId,statusMessage:c.statusMessage};this.ws.send(JSON.stringify({command:"CLIENT_REPORT",data:t}))},sendReport:async function(){try{if(this.isSendReport)if(this.isConnected){const t={deviceId:c.deviceId,userId:c.userId,cpuUse:await r.getCpuUse(),tempe:await r.getCpuTemperature(),statusMessage:c.statusMessage,isRunning:c.isRunning};d.isRunning&&(t.hash=c.hash||0,t.cpumhz=c.root?await r.getCpuMhz(4):0),"127.0.0.1"==c.localIp&&(c.localIp=r.getDeviceIP(),t.localIp=c.localIp),this.ws.send(JSON.stringify({command:"CLIENT_REPORT",data:t})),console.log("[Report] Gửi thông tin:",t)}else{if(!await r.checkServerConnection()&&c.root){this.isSendReport=!1,console.log("[Report] Bật tắt wifi xem sao...");const t=n(a.exec);await t('su -c "svc wifi disable"'),await r.delay(5e3),await t('su -c "svc wifi enable"'),await r.delay(5e3),await t('su -c "svc wifi enable"'),console.log("[Report] Chờ 30s kết nối lại..."),await r.delay(3e4)}await r.delay(5e3),this.connectWS()}}catch(t){console.log(t)}},executeCommand:function(t){try{a.exec(t.command,((e,i,n)=>{const o={userId:c.userId,deviceId:c.deviceId,command:t.command,type:"success",message:i};(e||n.length>0)&&(o.type="error",o.message=`${e?e.message:""} ${n}`),this.ws.send(JSON.stringify({command:"CLIENT_TASK_RESULT",data:o}))}))}catch(e){const i={userId:c.userId,deviceId:c.deviceId,command:t.command,type:"error",message:JSON.stringify(error)};this.ws.send(JSON.stringify({command:"CLIENT_TASK_RESULT",data:i}))}},closeConnection:function(){this.ws&&this.ws.close(),this.isSendReport=!1},getRandomInt:function(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t)+t)}}},811:(t,e,i)=>{i(973),i(604);const n=i(734),o=i(630),a=i(308),s=i(655),r=i(203);t.exports={jobChangeStatus:async function(t){try{if(n.jobAssign){if(t.isRunning!=n.isRunning){if(0==n.jobAssign.type)return void(t.isRunning?o.runMining():await o.stopMining());t.isRunning?a.startJob():a.stopJob()}}else this.logErrorToServer("Không tìm thấy công việc nào trên thiết bị.")}catch(t){this.logErrorToServer(t)}},changeJob:async function(t){try{if(!t.job)return void logErrorToServer("Không tìm thấy job trong data gửi về",t);n.jobAssign&&0==n.jobAssign.type?await o.stopMining():await a.stopJob(),n.jobAssign=t.job,0==n.jobAssign.type?(await o.setupFileMining(),o.runMining(),n.adbWifi&&(this.logErrorToServer("Mở termux"),s.openApp("com.termux"))):await a.startJob()}catch(t){this.logErrorToServer(t.message)}},logErrorToServer:async function(t){r.error(t),n.statusMessage=t}}},273:t=>{function e(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}e.keys=()=>[],e.resolve=e,e.id=273,t.exports=e},167:t=>{"use strict";t.exports=require("axios")},142:t=>{"use strict";t.exports=require("dotenv")},77:t=>{"use strict";t.exports=require("ip")},946:t=>{"use strict";t.exports=require("node-os-utils")},791:t=>{"use strict";t.exports=require("readline-sync")},31:t=>{"use strict";t.exports=require("shortid")},370:t=>{"use strict";t.exports=require("systeminformation")},41:t=>{"use strict";t.exports=require("tree-kill")},171:t=>{"use strict";t.exports=require("webdriverio")},773:t=>{"use strict";t.exports=require("winston")},352:t=>{"use strict";t.exports=require("ws")},81:t=>{"use strict";t.exports=require("child_process")},147:t=>{"use strict";t.exports=require("fs")},718:t=>{"use strict";t.exports=require("node:child_process")},17:t=>{"use strict";t.exports=require("path")},837:t=>{"use strict";t.exports=require("util")}},e={};function i(n){var o=e[n];if(void 0!==o)return o.exports;var a=e[n]={exports:{}};return t[n](a,a.exports,i),a.exports}i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{const t=i(367),e=i(734),n=i(630),o=i(308),a=i(919),s=(i(655),i(604)),r=i(973);let c;process.on("SIGINT",(()=>{n.stopMining(),o.stopJob(),a.stopAppServer(),t.closeConnection(),clearInterval(c)})),async function(){if(await e.getConfig()){for(;!await e.getConfigFromServer();)console.log("Chờ 5s kết nối lại..."),await s.delay(5e3);if(t.connectWS(),e.isAutoDevice&&a.startAppServer(),e.jobAssign&&0==e.jobAssign.type?await n.setupFileMining()&&n.runMining():console.log("Đang thiết lập dừng đào coin..."),!r.isDevMode){const e=t.getRandomInt(1e4,3e4);await s.delay(e)}c=setInterval((()=>{t.sendReport()}),e.timeOutReport||2e4)}}()})()})();