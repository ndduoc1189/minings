(()=>{var t={338:(t,e,i)=>{const n=i(538),a=i(655),o=i(734),s={openApp:async function(){a.log("Mở app...");const t="com.cell47.College_Proxy";await a.inputKey("3"),await a.stopApp(t),await a.sleep(1),await a.clearData(t),await a.sleep(1),await a.openApp(t),await a.sleep(5),await a.findByXpath("id:android:id/alertTitle",5)||(a.logError("Không khởi động được app proxy"),o.isRunning=!1)},confirmDialog:async function(){const t=await a.findByXpath("id:android:id/alertTitle",2);if(t)switch(await t.getText()){case"Location Permission Needed!":case"Permission Needed!":await a.tabByXPath("//android.widget.Button[contains(@text, 'CANCEL')]",2),n.currentFunctionIndex--;break;default:await a.tabByXPath("//android.widget.Button[contains(@text, 'OK')]",2)}else await a.tabByXPath("id:android:id/button1",2)},settingPermissions:async function(){if(await a.findByXpath("id:android:id/alertTitle",2))return void n.currentFunctionIndex--;let t;a.log("Thiết lập loại trừ termux ..."),await a.sleep(1),await a.tabByXPath("//android.widget.TextView[contains(@text, 'More Options')]",2),await a.tabByXPath("id:com.cell47.College_Proxy:id/menu_item_setting",2);let e=0;for(;!t&&e<50;)e++,t=await a.findByXpath("//android.widget.TextView[contains(@text, 'com.termux')]",1),await a.swipeUp();t?t.click():(a.log("Dừng hành động..."),o.isRunning=!1),await a.tabByXPath("//android.widget.Button[contains(@text, 'SAVE SETTINGS')]",1)},setProxy:async function(){a.log("Thêm proxy để chạy ...");const t=await a.findByXpath("id:com.cell47.College_Proxy:id/editText_address",2);t&&(await t.clearValue(),await t.click(),await a.inputText(o.proxy.host));const e=await a.findByXpath("id:com.cell47.College_Proxy:id/editText_port",2);e&&(await e.clearValue(),await e.click(),await a.inputText(o.proxy.port));const i=await a.findByXpath("id:com.cell47.College_Proxy:id/editText_username",2),n=await a.findByXpath("id:com.cell47.College_Proxy:id/editText_password",2);o.proxy.username&&o.proxy.pass&&i&&n&&(await i.clearValue(),await i.click(),await a.inputText(o.proxy.username),await n.clearValue(),await n.click(),await a.inputText(o.proxy.pass)),await a.tabByXPath("id:com.cell47.College_Proxy:id/proxy_start_button",1),await a.tabByXPath("id:android:id/button1",5);const s=await a.findByXpath("id:android:id/alertTitle",5);if("Configuration Ready"==await s.getText()){await a.tabByXPath("id:android:id/button1"),await a.tabByXPath("id:com.sec.android.app.sbrowser:id/customtab_close");const t=await a.findByXpath("id:com.cell47.College_Proxy:id/id_ok",1);t&&t.click(),await a.inputKey("3"),a.Log("Kết nối proxy thành công")}}};t.exports=async function(){if(!o.proxy)return a.logError("Thiết bị chưa được cấu hình proxy"),!1;await n.Run(s)}},314:(t,e,i)=>{const n=i(538),a=(i(655),i(734),{});t.exports=async function(){await n.Run(a)}},342:(t,e,i)=>{const n=i(538),a=i(655),o=i(734),s="com.google.android.youtube",r={installApp:async function(){a.log("Kiem tra cai dat youtube"),await a.installApp(s,"https://auto.dndvina.com/apk/YouTube_18.43.41.apk")},openApp:async function(){a.log("Mở youtube"),await a.inputKey("3"),await a.stopApp(s),await a.sleep(1),await a.clearData(s),await a.sleep(1),await a.openApp(s),await a.sleep(5),await a.findByXpath("id:com.google.android.youtube:id/bottom_bar_container",10)||(a.logError("Không mở được ứng dụng.."),o.isRunning=!1)},findPlaylist:async function(){a.log("Tìm kiếm danh sách phát theo từ khóa"),await a.tabByXPath('//android.widget.ImageView[@content-desc="Search"]'),await a.inputText(n.params.listKey),await a.inputKey("66");let t,e=0;for(;!t&&e<10&&(e++,o.isRunning);)t=await a.findByXpath(`//android.view.ViewGroup[contains(@content-desc, '${n.params.keyVal}')]`,1),t||await a.swipeUp();t&&(await a.sleep(1),t.click()),await a.tabByXPath("id:com.google.android.youtube:id/shuffle_button_label")},viewVideo:async function(){}};t.exports=async function(t){n.params=t,await n.Run(r)}},636:(t,e,i)=>{const n=i(538),a=i(655),o=(i(734),{proxyAPK:async function(){await a.installApp("com.cell47.College_Proxy","https://auto.dndvina.com/apk/collegeproxy.apk")},adbApk:async function(){await a.isAdbKeyboardInstalled()||(await a.installApp("com.android.adbkeyboard","https://auto.dndvina.com/apk/ADBKeyboard.apk"),await a.runAdbShellCommand("ime enable com.android.adbkeyboard/.AdbIME"),await a.runAdbShellCommand("ime set com.android.adbkeyboard/.AdbIME"))},youtube:async function(){a.log("Kiem tra cai dat youtube"),await a.installApp("com.google.android.youtube","https://auto.dndvina.com/apk/YouTube_18.43.41.apk")}});t.exports=async function(){await n.Run(o)}},52:(t,e,i)=>{const n=i(538),a=i(655),o=(i(734),"com.twitter.android"),s={openApp:async function(){a.log("Mở X"),await a.inputKey("3"),await a.installApp(o,"https://auto.dndvina.com/apk/twitter-x10.14.0.apk"),await a.stopApp(o),await a.sleep(1),await a.clearData(o),await a.sleep(1),await a.openApp(o),await a.sleep(5)}};t.exports=async function(){await n.Run(s)}},772:(t,e,i)=>{const n=i(538),a=i(655),o=i(734),s="com.google.android.youtube",r={openApp:async function(){a.log("Mở youtube"),await a.inputKey("3"),await a.stopApp(s),await a.sleep(1),await a.clearData(s),await a.sleep(1),await a.openApp(s),await a.sleep(5),await a.findByXpath("id:com.google.android.youtube:id/youtube_logo",10)||(a.logError("Không mở được ứng dụng.."),o.isRunning=!1)}};t.exports=async function(t){n.params=t,await n.Run(r)}},67:(t,e,i)=>{const n=i(538),a=i(655),o=i(734),s={findVideo:async function(){if(a.log("Tìm kiếm video theo từ khóa"),!n.params.listKey||!n.params.listKey.includes("|"))return o.isRunning=!1,void a.logError("Param không hợp lệ.");const t=n.params.listKey,e=t.split("|")[0],i=t.split("|")[1];await a.tabByXPath('//android.widget.ImageView[@content-desc="Search"]'),await a.isKeyboardShown()||await a.tabByXPath("id:com.google.android.youtube:id/search_edit_text"),await a.sleep(1),await a.inputText(e),await a.inputKey("66");let s,r=0;for(;!s&&r<50&&(r++,o.isRunning);)s=await a.findByXpath(`//android.view.ViewGroup[contains(@content-desc, '${i}')]`,1),s||await a.swipeUp();s?(await a.sleep(1),n.cVideoName=await s.getAttribute("content-desc"),await s.click()):(a.logError("không tìm được video"),o.isRunning=!1)},viewVideo:async function(){if(!await a.findByXpath("id:com.google.android.youtube:id/watch_while_time_bar_view",2))return this.currentFunctionIndex--,void a.logError(`không xem được video ${n.cVideoName}`);a.log(`Bắt đầu xem video ${n.cVideoName}`);const t=a.getRandomInt(5e4,15e4);a.log(`Tổng thời gian sẽ xem ${t/1e3} giây`);let e=0;for(;e<t;){e+=1e4;const t=await a.findByXpath("id:com.google.android.youtube:id/skip_ad_button",1);t?(a.log("Bấm bỏ qua quảng cáo..."),t.click()):a.log(`Đang xem video ${n.cVideoName}`),await a.sleep(5)}a.log("Đã xem xong video...")}};t.exports=async function(t){n.params=t,await n.Run(s)}},444:(t,e,i)=>{var n={"./AddProxy":338,"./AddProxy.js":338,"./Temp":314,"./Temp.js":314,"./Youtube-Playlist":342,"./Youtube-Playlist.js":342,"./install":636,"./install.js":636,"./reg-x":52,"./reg-x.js":52,"./youtube-open":772,"./youtube-open.js":772,"./youtube-search":67,"./youtube-search.js":67};function a(t){var e=o(t);return i(e)}function o(t){if(!i.o(n,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return n[t]}a.keys=function(){return Object.keys(n)},a.resolve=o,t.exports=a,a.id=444},973:(t,e,i)=>{const n=i(17),a=i(142),o=process.cwd();a.config({path:".env.product"}),t.exports={version:2.6,isDevMode:!1,binPath:"/data/data/com.termux/files/usr/bin/",apiURL:process.env.API_URL,wsURL:process.env.WS_URL,apiURLv2:process.env.API_URL_V2,configPath:n.join(o,"./contents/userconfig.json"),deviceConfig:n.join(o,"./contents/deviceconfig.json"),logFile:n.join(o,"./contents/log-mining.txt"),pathConfig:n.join(o,"./contents/config.json"),pathMining:n.join(o,"./contents/mining-script.sh"),pathUserKey:n.join(o,"../tbhkey"),pathDeviceKey:n.join(o,"../devicekey"),ADB_PORT:process.env.ADB_PORT,APPIUM_PORT:4739,AppiumStatus:{NOT_RUNNING:0,STARTING:1,RUNNING:2}}},538:(t,e,i)=>{const n=i(203),a=i(734);t.exports=new class{constructor(){this.isRunning=!0,this.currentFunctionIndex=0}async Run(t){if("object"!=typeof t)return void n.error("fnAction should be an object with functions.");const e=Object.values(t);for(this.currentFunctionIndex=0;this.isRunning&&a.isRunning&&this.currentFunctionIndex<e.length;){const t=e[this.currentFunctionIndex];await t.call(this),this.isRunning||n.log(`Function ${this.currentFunctionIndex+1} encountered an error.`),this.currentFunctionIndex++}}}},245:(t,e,i)=>{const n=i(167),a=(i(734),i(973));t.exports={getTaskDetail:async function(t){const e=`${a.apiURLv2}/script/getByScriptId/${t}`;return await this.get(e)},get:async function(t){const e=(await n.get(t)).data;if(e.data)return e.data}}},919:(t,e,i)=>{const{exec:n,execSync:a}=i(81),o=i(734),s=i(203),r=i(973);t.exports={appiumProcess:null,startAppServer:function(){if(o.appiumStatus===r.AppiumStatus.NOT_RUNNING){let t=`export JAVA_HOME=/data/data/com.termux/files/usr/opt/openjdk && export ANDROID_HOME=/data/data/com.termux/files/usr/share/android-sdk && appium --port ${r.APPIUM_PORT}`;"pNIXsc4kU"==o.deviceId&&(t=`appium --port ${r.APPIUM_PORT}`),this.appiumProcess=n(t),o.appiumStatus=r.AppiumStatus.STARTING,s.info("Khởi động Server App..."),this.appiumProcess.stdout.on("data",(t=>{t.includes("Appium REST http interface listener started on http://0.0.0.0:")&&(s.info("Server App đã hoạt động."),o.appiumStatus=r.AppiumStatus.RUNNING,this.appiumProcess.stdout.removeAllListeners("data"))})),this.appiumProcess.stderr.setEncoding("utf8"),this.appiumProcess.stderr.on("data",(t=>{console.log(`[Serrver App]:${t}`)})),this.appiumProcess.on("close",(t=>{s.error(`Server App dừng ${t}.`),o.appiumStatus=r.AppiumStatus.NOT_RUNNING,this.appiumProcess=null}))}else s.info("Server App đang chạy")},stopAppServer:async function(){o.appiumStatus===r.AppiumStatus.RUNNING&&(this.appiumProcess.kill(),this.appiumProcess=null,s.info("Đã dừng Server App."),o.appiumStatus=r.AppiumStatus.NOT_RUNNING),this.appiumProcess=null}}},655:(t,e,i)=>{const{exec:n,execSync:a}=i(81),o=i(171),s=i(734),r=i(203),c=i(167),d=i(17),u=i(147),l=i(973);t.exports={driver:null,connectAP:async function(){try{if(!this.driver){const t={hostname:"127.0.0.1",port:l.APPIUM_PORT,logLevel:"error",capabilities:{platformName:"Android","appium:udid":s.adbId,"appium:automationName":"UiAutomator2","appium:platformVersion":`${s.androidVersion||9}`,"appium:adbPort":l.ADB_PORT}};this.driver=await o.remote(t),r.info("Đã kết nối đến Server App.")}return!0}catch(t){return r.error(`Loi khoi tao driver${t}`),!1}},disconnectAP:async function(){this.driver&&this.driver.is&&(await this.driver.deleteSession(),this.driver=null)},customAction:async function(t,e){try{const n=`./customActions/${t}.js`,a=i(273)(n);await a(this,e)}catch(e){r.error(`Không tìm thấy hành động: ${t}`),this.running=!1}},isKeyboardShown:async function(){return await this.driver.isKeyboardShown()},fixRotation:async function(){await this.runAdbShellCommand("settings put system accelerometer_rotation 0")},tabByXPath:async function(t){const e=await this.driver.$(t);await e.isExisting()?await e.click():r.error(`Không tìm thấy phần tử với xpath: ${t}`)},findByXpath:async function(t,e=1){let i,n=!1,a=1;for(;a<=e&&!n;)i=await this.driver.$(t,1e3),n=await i.isExisting(),a++,await this.sleep(1);return n?i:null},moveUp:async function(){await this.driver.touchAction([{action:"press",x:473,y:1352},{action:"moveTo",x:511,y:735},"release"])},tap:async function(t,e){await this.driver.touchAction({actions:"tap",x:t,y:e})},swipeUp:async function(){await this.runAdbShellCommand("input swipe 200 985 200 35")},swipeDown:async function(){await this.driver.touchAction([{action:"press",x:300,y:236},{action:"moveTo",x:300,y:936},"release"])},swipeLeft:async function(){await this.driver.touchAction([{action:"press",x:879,y:450},{action:"moveTo",x:179,y:450},"release"])},swipeRight:async function(){await this.driver.touchAction([{action:"press",x:179,y:450},{action:"moveTo",x:879,y:450},"release"])},inputText:async function(t){if(await this.isAdbKeyboardInstalled())for(let e=0;e<t.length;e++){const i=Buffer.from(t.charAt(e)).toString("base64");await this.runAdbShellCommand(`am broadcast -a ADB_INPUT_B64 --es msg '${i}'`);const n=Math.floor(-299*Math.random()+50);await new Promise((t=>setTimeout(t,n)))}else await this.runAdbShellCommand(`input text ${t}`)},isAdbKeyboardInstalled:async function(){try{const t=await this.runAdbShellCommand("ime list -a");return!!t&&t.includes("com.android.adbkeyboard/.AdbIME")}catch(t){return!1}},inputKey:async function(t){await this.runAdbShellCommand(`input keyevent  "${t}"`)},sleep:async function(t){await new Promise((e=>setTimeout(e,1e3*t)))},clearData:async function(t){await this.runAdbShellCommand(`pm clear ${t}`)},stopApp:async function(t){await this.runAdbShellCommand(`am force-stop ${t}`)},openApp:async function(t,e){if(!await this.isAppInstalled(t))return r.error(`Chưa cài: ${t}`),!1;await this.runAdbShellCommand(`monkey -p ${t}${e||""} -c android.intent.category.LAUNCHER 1`),await this.fixRotation()},isAppInstalled:async function(t){try{return(await this.runAdbShellCommand("pm list packages")).indexOf(t)>-1}catch(t){return r.error(`Lỗi xảy ra: ${t}`),!1}},installApp:async function(t,e){try{if(!await this.isAppInstalled(t)){const t=await this.downloadFile(e);await this.runAdbCommand(`install ${t}`),console.log(`Đã cài đặt ứng dụng từ ${e}`)}}catch(t){console.error(`Lỗi xảy ra khi tải và cài đặt ứng dụng: ${t}`),s.isRunning=!1}},downloadFile:async function(t){try{const e=await c.get(t,{responseType:"stream"}),i=d.basename(t),n=d.join("/","../../contents",i);await u.mkdir(d.dirname(n),{recursive:!0},(t=>{t&&console.error(`Lỗi khi tạo thư mục: ${t}`)}));const a=u.createWriteStream(n);return e.data.pipe(a),await new Promise(((t,e)=>{a.on("finish",t),a.on("error",e)})),console.log(`Tải tệp từ ${t} thành công và đã lưu vào ${n}`),n}catch(e){return console.error(`Lỗi xảy ra khi tải tệp từ ${t}: ${e}`),null}},pullFile:async function(t,e){const i=`pull ${t} ${e}`;await this.runAdbCommand(i)},runAdbShellCommand:async function(t){const e=`adb -P ${l.ADB_PORT} -s ${s.adbId} shell ${t}`;return new Promise(((t,i)=>{n(e,((e,n,a)=>{e?(r.error(`Lỗi xảy ra: ${e}`),i(e)):t(n)}))}))},runAdbCommand:async function(t){const e=`adb -P ${l.ADB_PORT} -s ${s.adbId} ${t}`;return new Promise(((t,i)=>{n(e,((e,n,a)=>{e?(r.error(`Lỗi xảy ra: ${e}`),i(e)):t(n)}))}))},getRandomInt:function(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t)+t)},log:function(t){r.info(`${t}`),s.statusMessage=t},logError:function(t){r.error(`[Lỗi]-${t}`),s.statusMessage=t}}},604:(t,e,i)=>{const{promisify:n}=i(837),a=(i(17),n(i(718).execFile),i(81).exec),o=i(167),s=i(973),r=i(370);var c=i(77);const d=i(946),u=i(147),l=n(u.exists),p=n(u.readFile),h=n(u.writeFile);t.exports={async getProp(t){try{const{stdout:e,stderr:i}=await n(a)(`getprop ${t}`);return i?null:e.trim()}catch(t){return null}},killProcess(t){a(`chmod u+x ${filePath}`,((e,i,n)=>{e?console.error(`Kill process ${t} error: ${e}`):console.log(`Killed process ${t}`)}))},async getUserConfig(){let t;if(await l(s.configPath)){let e=u.readFileSync(s.configPath);t=JSON.parse(e);const i=(await o.get(`${s.apiURL}/user/get/${t.userName}`)).data;return i.data&&(t=i.data),t}{console.log(`Config đã thiết lập${s.configPath}`);const e=i(791);for(;!t;){let i=await e.question("Nhap thong tin User: ");const n=(await o.get(`${s.apiURL}/user/get/${i}`)).data;if(n.data)return t=n.data,await u.promises.writeFile(s.configPath,JSON.stringify(t)),t;console.log("User khong ton tai!")}}},async getDeviceConfig(){let t,e=await this.getProp("ro.serialno");return await l(s.deviceConfig)?(t=JSON.parse(await p(s.deviceConfig)),e&&e!=t.deviceId&&(t.deviceId=e)):t={deviceId:e||i(31).generate(),deviceName:await this.getProp("ro.product.model"),cpuUse:0},t.adbWifi=await this.checkADB(),t.root=await this.checkRootPermission(),t.localIp=this.getDeviceIP(),t.sshUser=await this.getUserSSH(),t.model=await this.getProp("ro.product.model"),t.cpuCores=this.getCpuCores(),await h(s.deviceConfig,JSON.stringify(t)),t},async removeConfig(t){try{t&&await l(s.configPath)&&(await u.unlinkSync(s.configPath),console.log("Da xoa thong tin user")),await l(s.deviceConfig)&&(await u.unlinkSync(s.deviceConfig),console.log("Da xoa thong tin thiet bi"))}catch(t){console.error(t)}},getDeviceIP(){try{return c.address()}catch(t){return t}},async getUserSSH(){const{stdout:t,error:e}=await n(a)("whoami");return e||t.trim()},async getCpuMhz(t){try{const{stdout:e,error:i}=await n(a)(`su -c "cat /sys/devices/system/cpu/cpu${t}/cpufreq/scaling_cur_freq"`);return i?0:parseInt(e.trim())}catch(t){return 0}},async getCpuUse(){try{const t=await r.currentLoad();return isNaN(t.currentLoad)?0:Math.round(t.currentLoad)}catch(t){return 0}},getCpuCores(){try{const t=d.cpu.count();return isNaN(t)?0:parseInt(t)}catch(t){return 0}},async getCpuTemperature(){try{return(await r.cpuTemperature()).main.toFixed(1)||0}catch(t){return 0}},async checkADB(){try{const t=n(a),e=await t(`adb -P ${s.ADB_PORT} devices`);return console.log(e),!!e.stdout.includes("emulator-5554")}catch(t){return console.log("Lỗi khi chạy lệnh adb:",t),!1}},async checkRootPermission(){try{const t=n(a),{stdout:e}=await t('su -c "id"');return!!e.toLowerCase().includes("uid=0")}catch(t){return!1}},async checkSudoLib(){try{const t=n(a),e=await t("sudo ls"),{stdout:i,stderr:o}=e;return!(!i.toLowerCase().includes("mnworker")&&!i.toLowerCase().includes("readme.md")&&(o&&o.length,1))}catch(t){return!1}},delay:async t=>new Promise((e=>setTimeout(e,t))),async checkServerConnection(){try{return!!((await o.get(`${s.apiURLv2}/device/get-config/${this.userId}/${this.deviceId}`)).data.status="success")}catch(t){return!1}}}},734:(t,e,i)=>{const{promisify:n}=i(837),a=i(147),o=n(a.exists),s=n(a.readFile),r=n(a.writeFile),c=i(973),d=i(604),u=i(167),{exec:l}=i(81);let p={userId:"",deviceId:"",root:!1,appiumStatus:c.AppiumStatus.NOT_RUNNING,getConfig:async function(){try{this.userId=await s(c.pathUserKey,"utf8"),this.userId=this.userId.trim();const t=await d.getProp("ro.serialno");t?this.deviceId=t:await o(c.pathDeviceKey)?this.deviceId=await s(c.pathDeviceKey,"utf8"):(this.deviceId=i(31).generate(),await r(c.pathDeviceKey,this.deviceId)),this.root=await d.checkRootPermission(),this.sudo=await d.checkSudoLib(),this.model=await d.getProp("ro.product.model"),this.AndroidVersion=await d.getProp("ro.build.version.release"),this.localIp=d.getDeviceIP();const e=this.versionConvert(this.AndroidVersion);return this.adbWifi=e>=9&&await d.checkADB(),"pNIXsc4kU"==this.deviceId?(this.adbId="10.0.0.145:5555",this.adbWifi=!0):this.adbId="emulator-5554",this.sshUser=await d.getUserSSH(),this.cpuCores=d.getCpuCores(),this.isMining=!1,this.statusMessage="",this.workerVersion=c.version,!0}catch(t){return console.error(`[Device] Không tìm thấy file user key '${c.pathUserKey}'.`),!1}},getConfigFromServer:async function(){try{console.log("[Device] Đọc thông tin thiết lập từ máy chủ...");const t=(await u.get(`${c.apiURLv2}/device/get-config/${this.userId}/${this.deviceId}`)).data;return t.data&&(Object.assign(this,t.data),this.deviceName=t.data.deviceName||this.model||"NoName",this.workerVersion=c.version,c.isDevMode&&(this.timeOutReport=5e3)),!0}catch(t){return console.error("[Device] Không đọc được thiết lập từ máy chủ."),!1}},getDeviceName:function(){return this.deviceName||this.deviceId},runCMD:function(t){return new Promise(((e,i)=>{l(t,((t,n,a)=>{t?i(t):e(n)}))}))},openApp:function(t){const e=`am start -n ${t}`;return this.runCMD(e)},versionConvert:function(t){try{const e=t.split(".")[0];return parseInt(e,10)||0}catch(t){return 0}}};t.exports=p},308:(t,e,i)=>{const n=i(734),a=(i(203),i(655)),o=i(919),s=i(245),r=i(604),c=i(973);t.exports={startJob:async function(){if(n.adbWifi=await r.checkADB()||"pNIXsc4kU"==n.deviceId,n.adbWifi){if(n.appiumStatus==c.AppiumStatus.STARTING&&(a.log("Chờ 30s khởi động server App..."),await a.sleep(30)),n.appiumStatus==c.AppiumStatus.NOT_RUNNING&&(o.startAppServer(),a.log("Chờ 30s khởi động lại server App..."),await a.sleep(30),n.appiumStatus!==c.AppiumStatus.STARTING))return a.logError("Server App không hoạt động"),void o.stopAppServer();if(n.isRunning=!0,await n.getConfigFromServer(),a.log("Kết nối máy chủ App..."),!await a.connectAP())return n.isRunning=!1,void a.logError("Không kết nối được máy chủ Appium...");if(n.jobAssign.jobScripts){for(const t of n.jobAssign.jobScripts){if(!n.isRunning)break;const e=await s.getTaskDetail(t.scriptId),o=i(444)(`./${e.scriptFile}`);a.log(`Chạy: ${e.scriptName}`);const r=JSON.parse(t.param);await o(r)}n.isRunning=!1,a.log("Hoàn tất Job...")}else n.isRunning=!1,a.logError("Không tìm thấy job")}else a.logError("Thiết bị không thể kết nối adb wifi.")},stopJob:async function(){n.isRunning&&(n.isRunning=!1,a.log("Tạm dừng Job..."))}}},203:(t,e,i)=>{const n=i(773),a=i(17),o={file:{level:"info",filename:a.resolve("/","../../logs/info.log"),handleExceptions:!0,json:!0,maxsize:1048576,maxFiles:5,colorize:!1},file:{level:"error",filename:a.resolve("/","../../logs/error.log"),handleExceptions:!0,json:!0,maxsize:1048576,maxFiles:5,colorize:!1},console:{level:"debug",handleExceptions:!0,json:!1,colorize:!0}},s=n.createLogger({levels:n.config.npm.levels,format:n.format.combine(n.format.timestamp(),n.format.prettyPrint(),n.format.printf((t=>`[${t.level}] ${t.timestamp} : ${t.message}`))),transports:[new n.transports.File(o.file),new n.transports.Console(o.console)],exitOnError:!1});t.exports=s},630:(t,e,i)=>{const n=i(973),a=i(604),o=i(734),{promisify:s}=i(837),r=s(i(147).writeFile),c=s(i(718).exec),{spawn:d,exec:u}=i(81),l=i(41),p=i(17),h=i(203);t.exports={isRunning:!1,setupFileMining:async function(){console.log(`[Mining] Thiết lập đào: ${o.jobAssign.jobName}...`);try{if(o.jobAssign.jobScripts){this.miningParams=o.jobAssign.jobScripts.param.replace("[DEVICE_ID]",o.deviceName),this.miningPath=o.jobAssign.jobScripts.filePath,this.fileMiningName=p.basename(this.miningPath),o.hash=0;const t=`#!/data/data/com.termux/files/usr/bin/sh\r\n${this.miningPath} ${this.miningParams}`;return await r(n.pathMining,t),await c(`chmod +x ${n.pathMining}`),await c(`chmod u+x ${this.miningPath}`),console.log(t),!0}}catch(t){console.log(t)}return console.log("[Mining] Không ghi được file đào tool đào"),!1},runMining:function(){console.log(`Bắt đầu đào: ${o.jobAssign.jobName}`),o.hash=0,o.root&&o.sudo&&o.AndroidVersion.indexOf("9")>-1?(this.miningProcess=d("sudo",["bash",n.pathMining]),console.log(`Bắt đầu đào: ${o.jobAssign.jobName} - SUDO`)):this.miningProcess=d("bash",[n.pathMining]),this.isRunning=!0,o.isRunning=!0,this.miningProcess.stdout.setEncoding("utf8"),this.miningProcess.stdout.on("data",(t=>{console.log(`[Mining] ${t}`);try{let e=t;"xmrig"==this.fileMiningName&&(e=t.replace(/\u001B\[[0-9;]*m/g,""));const i={astrominer:/Hashrate\s([\d.]+)\s?[MK]?H\/s/,ccminer:/(\d+(?:\.\d+)?) kH\/s/,xmrig:/max\s(\d+\.\d+)\sH\/s/};let n=e.match(i[this.fileMiningName]);if(n){const t=n[1];t&&(o.hash=parseFloat(t.trim()))}o.statusMessage=`${o.jobAssign.jobName} - Hash: ${o.hash}`}catch(t){console.log(t),o.hash=0,o.statusMessage=`${o.jobAssign.jobName} - Hash: ${o.hash}`}})),this.miningProcess.stderr.setEncoding("utf8"),this.miningProcess.stderr.on("data",(t=>{console.error(`[Mining-error]: ${t}`)}))},stopMining:async function(){if(this.isRunning){if(this.miningProcess)try{l(this.miningProcess.pid,"SIGTERM",(t=>{t&&console.error("Error killing child process:",t)})),await a.delay(1e3);const t=`pkill -f "${this.fileMiningName}"`;o.root?await c(`su -c '${t}'`):await c(t),await a.delay(1e3)}catch(t){h.error(t.message)}finally{this.miningProcess=null}this.isRunning=!1,o.isRunning=!1,console.log(`[Mining] Tạm dừng đào:${o.jobAssign.jobName}`)}}}},367:(t,e,i)=>{const{promisify:n}=i(837),a=i(352),o=i(81),s=i(973),r=i(604),c=i(734),d=i(630),u=i(811);t.exports={isSendReport:!0,isConnected:!1,ws:null,connectWS:function(){try{if(!r.checkServerConnection())return void console.log("[Report-Error] Mất kết nối máy chủ !.");console.log(`[Report] Kết nối với máy chủ: ${c.userId} : ${c.deviceId} :${s.wsURL}`),this.ws=new a(s.wsURL),this.ws.addEventListener("open",(()=>{console.log("[Report] Đã kết nối đến máy chủ");const t={userId:c.userId,deviceId:c.deviceId,model:c.model,Status:1,localIp:c.localIp,sshUser:c.sshUser,cpuCores:c.cpuCores,root:c.root,workerVersion:c.workerVersion,androidVersion:c.AndroidVersion};console.log(t),this.isConnected=!0,this.isSendReport=!0,this.ws.send(JSON.stringify({command:"CLIENT_REGISTER",data:t}))})),this.ws.addEventListener("message",(t=>{const{command:e,data:i}=JSON.parse(t.data);switch(e){case"CLIENT_TASK":console.log(`Thực hiện lệnh ${i.command}`),this.executeCommand(i);break;case"CLIENT_UPDATE":!async function(t){for(d.isRunning&&await d.stopMining();!await c.getConfigFromServer();)console.log("[Device] Chờ 5s kết nối lại..."),await r.delay(5e3);c.isMining&&await d.setupFileMining()&&d.runMining()}();break;case"CHANGE_JOB":u.changeJob(i);break;case"CHANGE_STATUS_JOB":u.jobChangeStatus(i);break;default:c.userId,c.deviceId,this.ws.send(JSON.stringify({command:"CLIENT_TASK_RESULT",data:i})),console.log(`Thiết bị chưa được thiết lập nhận lệnh ${e}`)}"exec"===e&&this.executeCommand(i.command)})),this.ws.addEventListener("close",(()=>{this.isConnected=!1,this.isSendReport&&(this.ws=null,console.log("[Report] Mất kết nối máy chủ!"))}))}catch(t){this.isConnected=!1,console.log("[Report-Error] Lỗi kết nối rồi!",t),this.isSendReport&&(this.ws=null)}},sendStatusMessage:async function(){const t={deviceId:c.deviceId,userId:c.userId,statusMessage:c.statusMessage};this.ws.send(JSON.stringify({command:"CLIENT_REPORT",data:t}))},sendReport:async function(){try{if(this.isSendReport)if(this.isConnected){const t={deviceId:c.deviceId,userId:c.userId,cpuUse:await r.getCpuUse(),tempe:await r.getCpuTemperature(),statusMessage:c.statusMessage,isRunning:c.isRunning};d.isRunning&&(t.hash=c.hash||0,t.cpumhz=c.root?await r.getCpuMhz(4):0),"127.0.0.1"==c.localIp&&(c.localIp=r.getDeviceIP(),t.localIp=c.localIp),this.ws.send(JSON.stringify({command:"CLIENT_REPORT",data:t})),console.log("[Report] Gửi thông tin:",t)}else{if(!await r.checkServerConnection()&&c.root){this.isSendReport=!1,console.log("[Report] Bật tắt wifi xem sao...");const t=n(o.exec);await t('su -c "svc wifi disable"'),await r.delay(5e3),await t('su -c "svc wifi enable"'),await r.delay(5e3),await t('su -c "svc wifi enable"'),console.log("[Report] Chờ 30s kết nối lại..."),await r.delay(3e4)}await r.delay(5e3),this.connectWS()}}catch(t){console.log(t)}},executeCommand:function(t){try{o.exec(t.command,((e,i,n)=>{const a={userId:c.userId,deviceId:c.deviceId,command:t.command,type:"success",message:i};(e||n.length>0)&&(a.type="error",a.message=`${e?e.message:""} ${n}`),this.ws.send(JSON.stringify({command:"CLIENT_TASK_RESULT",data:a}))}))}catch(e){const i={userId:c.userId,deviceId:c.deviceId,command:t.command,type:"error",message:JSON.stringify(error)};this.ws.send(JSON.stringify({command:"CLIENT_TASK_RESULT",data:i}))}},closeConnection:function(){this.ws&&this.ws.close(),this.isSendReport=!1},getRandomInt:function(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t)+t)}}},811:(t,e,i)=>{i(973),i(604);const n=i(734),a=i(630),o=i(308),s=i(655),r=i(203);t.exports={jobChangeStatus:async function(t){try{if(n.jobAssign){if(t.isRunning!=n.isRunning){if(0==n.jobAssign.type)return void(t.isRunning?a.runMining():await a.stopMining());t.isRunning?o.startJob():o.stopJob()}}else this.logErrorToServer("Không tìm thấy công việc nào trên thiết bị.")}catch(t){this.logErrorToServer(t)}},changeJob:async function(t){try{if(!t.job)return void logErrorToServer("Không tìm thấy job trong data gửi về",t);n.jobAssign&&0==n.jobAssign.type?await a.stopMining():await o.stopJob(),n.jobAssign=t.job,0==n.jobAssign.type?(await a.setupFileMining(),a.runMining(),n.adbWifi&&(this.logErrorToServer("Mở termux"),s.openApp("com.termux"))):await o.startJob()}catch(t){this.logErrorToServer(t.message)}},logErrorToServer:async function(t){r.error(t),n.statusMessage=t}}},273:t=>{function e(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}e.keys=()=>[],e.resolve=e,e.id=273,t.exports=e},167:t=>{"use strict";t.exports=require("axios")},142:t=>{"use strict";t.exports=require("dotenv")},77:t=>{"use strict";t.exports=require("ip")},946:t=>{"use strict";t.exports=require("node-os-utils")},791:t=>{"use strict";t.exports=require("readline-sync")},31:t=>{"use strict";t.exports=require("shortid")},370:t=>{"use strict";t.exports=require("systeminformation")},41:t=>{"use strict";t.exports=require("tree-kill")},171:t=>{"use strict";t.exports=require("webdriverio")},773:t=>{"use strict";t.exports=require("winston")},352:t=>{"use strict";t.exports=require("ws")},81:t=>{"use strict";t.exports=require("child_process")},147:t=>{"use strict";t.exports=require("fs")},718:t=>{"use strict";t.exports=require("node:child_process")},17:t=>{"use strict";t.exports=require("path")},837:t=>{"use strict";t.exports=require("util")}},e={};function i(n){var a=e[n];if(void 0!==a)return a.exports;var o=e[n]={exports:{}};return t[n](o,o.exports,i),o.exports}i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{const t=i(367),e=i(734),n=i(630),a=i(308),o=i(919),s=(i(655),i(604)),r=i(973);let c;process.on("SIGINT",(()=>{n.stopMining(),a.stopJob(),o.stopAppServer(),t.closeConnection(),clearInterval(c)})),async function(){if(await e.getConfig()){for(;!await e.getConfigFromServer();)console.log("Chờ 5s kết nối lại..."),await s.delay(5e3);if(t.connectWS(),e.isAutoDevice&&o.startAppServer(),e.jobAssign&&0==e.jobAssign.type?await n.setupFileMining()&&n.runMining():console.log("Đang thiết lập dừng đào coin..."),!r.isDevMode){const e=t.getRandomInt(1e4,3e4);await s.delay(e)}c=setInterval((()=>{t.sendReport()}),e.timeOutReport||2e4)}}()})()})();